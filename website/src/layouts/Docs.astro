---
import { type CollectionEntry, getCollection } from 'astro:content';

import type { SupportedFramework, SupportedStyle } from '@/types/docs';

import NavBar from '@/components/NavBar/NavBar.astro';
import DocsSidebar from '@/components/docs/DocsSidebar.astro';
import Footer from '@/components/Footer.astro';

import Base from './Base.astro';
import { Selectors } from '@/components/docs/Selectors';

type Props<F extends SupportedFramework = SupportedFramework> = {
  doc: CollectionEntry<'docs'>;
  framework: F;
  style: SupportedStyle<F>;
  slug: string;
};

const { doc, framework, style, slug } = Astro.props;

// Fetch all docs to get their titles
const allDocs = await getCollection('docs');
const docTitles = new Map(allDocs.map((d) => [d.id, d.data.title]));
---

<Base title={[doc.data.title, 'Docs']} description={doc.data.description}>
  <slot name="head" slot="head" />
  <div
    class="grid grid-cols-1 lg:grid-cols-(--lg-grid-cols) min-h-screen"
    style="--lg-grid-cols: calc(var(--spacing) * 75) 1fr;grid-template-rows:auto minmax(0,1fr);"
  >
    <NavBar class="col-span-full">
      <DocsSidebar slot="mobile-nav" framework={framework} style={style} docTitles={docTitles} />
    </NavBar>
    <aside
      class="hidden lg:block lg:border-r border-light-40 dark:border-dark-80 sticky overflow-y-scroll"
      style="top: var(--nav-h); max-height: calc(100vh - var(--nav-h));"
    >
      <DocsSidebar framework={framework} style={style} docTitles={docTitles}>
        <Selectors client:load currentFramework={framework} currentStyle={style} currentSlug={slug} />
      </DocsSidebar>
    </aside>
    <div class="flex flex-col">
      <slot />
      <Footer class="mt-auto" />
    </div>
  </div>
</Base>
