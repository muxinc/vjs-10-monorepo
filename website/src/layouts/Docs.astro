---
import { type CollectionEntry, getCollection } from 'astro:content';

import type { AnySupportedStyle, SupportedFramework } from '@/types/docs';

import NavBar from '@/components/NavBar/NavBar.astro';
import DocsSidebar from '@/components/docs/DocsSidebar.astro';

import Base from './Base.astro';

type Props = {
  doc: CollectionEntry<'docs'>;
  framework: SupportedFramework;
  style: AnySupportedStyle;
};

const { doc, framework, style } = Astro.props;

// Fetch all docs to get their titles
const allDocs = await getCollection('docs');
const docTitles = new Map(allDocs.map((d) => [d.id, d.data.title]));
---

<Base title={doc.data.title} description={doc.data.description}>
  <div
    class="grid grid-cols-1 lg:grid-cols-(--lg-grid-cols) min-h-screen"
    style="--lg-grid-cols: calc(var(--spacing) * 75) 1fr;grid-template-rows:auto minmax(0,1fr);"
  >
    <NavBar class="col-span-full">
      <DocsSidebar slot="mobile-nav" framework={framework} style={style} docTitles={docTitles} />
    </NavBar>
    <aside
      class="hidden lg:block lg:border-r border-light-40 sticky overflow-y-scroll"
      style="top: var(--nav-h); max-height: calc(100vh - var(--nav-h));"
    >
      <DocsSidebar framework={framework} style={style} docTitles={docTitles} />
    </aside>
    <slot />
  </div>
</Base>
